<html>
<head>
<title>TestGrid.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #8c8c8c; font-style: italic;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
TestGrid.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">division</span>
<span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">unicode_literals</span>

<span class="s0">import </span><span class="s1">codecs</span>
<span class="s0">import </span><span class="s1">json</span>
<span class="s2"># import os</span>
<span class="s2"># import random</span>
<span class="s0">import </span><span class="s1">re</span>
<span class="s0">import </span><span class="s1">socket</span>
<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">threading</span>
<span class="s0">import </span><span class="s1">random</span>
<span class="s0">import </span><span class="s1">os</span>
<span class="s0">import </span><span class="s1">pickle</span>

<span class="s2"># Import WXPython</span>
<span class="s0">try</span><span class="s1">:</span>
    <span class="s0">import </span><span class="s1">wx</span>
<span class="s0">except </span><span class="s1">ImportError:</span>
    <span class="s0">raise </span><span class="s1">ImportError(</span><span class="s3">&quot;The wxPython module is required to run this program&quot;</span><span class="s1">)</span>

<span class="s2"># from pubsub import pub</span>
<span class="s0">import </span><span class="s1">wx.richtext </span><span class="s0">as </span><span class="s1">rt</span>

<span class="s2"># should be redundant</span>
<span class="s0">import </span><span class="s1">wx.grid</span>
<span class="s0">import </span><span class="s1">wx.lib.colourdb</span>


<span class="s2"># Creates window where player will interact</span>
<span class="s2"># Why does GuiWindow take a wx.Frame object as a parameter?</span>
<span class="s2"># What are the pic fields for?</span>

<span class="s2"># Contains two methods</span>
<span class="s2"># 1) remove_elements_from_sizer(self)</span>
<span class="s2"># 2) speaker_draw_stage(self)</span>
<span class="s2"># Fields are grouped into</span>
<span class="s2"># 1) Window properties (window height/width, image_buttons_1/2, AllowErase)</span>
<span class="s2"># 2) Game tracking (participant_no, listener_no, practice_over, round_counter/info, score, role)</span>
<span class="s2"># 3) Game setup (main_sizer, elements_in_sizer,image_height/width/path, instructions_file)</span>
<span class="s2"># 4) Picture info (alt/chosen_pic, listener_chosen_pic, pic_for_displaying)</span>
<span class="s2"># 5) After-game survey (submit_button_size, submitted_message, survey_answers)</span>
<span class="s2">#</span>

<span class="s0">class </span><span class="s1">GuiWindow(wx.Frame):</span>
    <span class="s2">&quot;&quot;&quot;Construct the window(s) the participants of the experiment see.&quot;&quot;&quot;</span>

    <span class="s2"># Constructor</span>
    <span class="s0">def </span><span class="s1">__init__(self, parent, id, title, host, name):</span>
        <span class="s2">&quot;&quot;&quot;Initialise the GUI window for the participant. 
 
        # :param parent   :the parent of this window 
        # :type parent    :wx python object 
        # :param id       :id of the frame, assigned automatically 
        # :type id        :int 
        # :param title    :name of the current window 
        # :type title     :str 
        # :param host     :name of the host 
        # :type host      :str 
        # :param name     :the participant's name 
        # :type name      :str 
        # &quot;&quot;&quot;</span>
        <span class="s2"># self.bufsize = 4096</span>
        <span class="s2"># self.host = host</span>
        <span class="s2"># self.port = 5000</span>

        <span class="s2"># &quot;&quot;&quot;INITIALISING GLOBAL VARIABLES&quot;&quot;&quot;</span>
        <span class="s2"># # name of the participant</span>
        <span class="s2"># self.name = name</span>
        <span class="s2"># # set self.ready to 1 by first message from server</span>
        <span class="s2"># # (means all clients are connected)</span>
        <span class="s2"># self.ready = 0</span>
        <span class="s2"># # set stage and role of players</span>
        <span class="s2"># self.stage = &quot;pregame&quot;</span>
        <span class="s2"># self.role = &quot;undecided&quot;</span>
        <span class="s2"># set image size</span>
        <span class="s2"># self.image_width = 200</span>
        <span class="s2"># self.image_height = 200</span>

        <span class="s2"># A sizer is a subwindow -&gt; used to organize the grid/buttons in the space</span>

        <span class="s1">self.image_width = </span><span class="s4">250</span>
        <span class="s1">self.image_height = </span><span class="s4">250</span>
        <span class="s2"># server_end_marker must be the same as in the Server script</span>
        <span class="s2"># self.server_end_marker = &quot;!!!%%%&amp;&amp;&amp;!!!&quot;</span>
        <span class="s2"># all elements of all sizers are collected in this list</span>
        <span class="s1">self.elements_in_sizer = []</span>

        <span class="s2"># path to instructions file given by a server message</span>
        <span class="s1">self.instructions_file = </span><span class="s3">&quot;&quot;</span>
        <span class="s2"># the image file(s)</span>
        <span class="s1">self.image_buttons_1 = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.image_buttons_2 = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.chosen_pic = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.alt_pic = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.listener_chosen_pic = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.pic_for_displaying = </span><span class="s3">&quot;&quot;</span>
        <span class="s2"># score</span>
        <span class="s1">self.score = </span><span class="s4">0</span>
        <span class="s1">self.round_counter = </span><span class="s4">0</span>
        <span class="s2"># path to the image directory</span>
        <span class="s1">self.image_path = </span><span class="s3">&quot;images&quot;</span>
        <span class="s2"># collect all sizer elements for clearing them in one</span>
        <span class="s2"># speaker and listener number for getting the right pairs</span>
        <span class="s1">self.speaker_no = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.listener_no = </span><span class="s3">&quot;&quot;</span>
        <span class="s2"># during the practice rounds, each client only has a</span>
        <span class="s2"># participant number without a role</span>
        <span class="s1">self.participant_no = </span><span class="s3">&quot;&quot;</span>
        <span class="s2"># answers of the survey</span>
        <span class="s1">self.survey_answers = </span><span class="s3">&quot;&quot;</span>
        <span class="s2"># size of the submit buttons</span>
        <span class="s1">self.submit_button_size = (</span><span class="s4">500</span><span class="s1">, -</span><span class="s4">1</span><span class="s1">)</span>
        <span class="s2"># the sentences generated by the speaker are added to this list</span>
        <span class="s2"># the message decides which state or stage is taken</span>
        <span class="s1">self.submitted_message = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.round_info = </span><span class="s3">&quot;&quot;</span>
        <span class="s1">self.practice_over = </span><span class="s0">False</span>
        <span class="s1">self.AllowErase = </span><span class="s0">True</span>
        <span class="s1">self.GridWidth = </span><span class="s4">12</span>
        <span class="s1">self.GridHeight = </span><span class="s4">12</span>

        <span class="s2"># What are these?</span>
        <span class="s2"># &quot;&quot;&quot;SERVER MESSAGES&quot;&quot;&quot;</span>
        <span class="s2"># # identifies special messages from the Server</span>
        <span class="s2"># self.srvr_msg = re.compile(r'9999.*9999(?!\s)')</span>
        <span class="s2"># self.kill_msg = re.compile(r&quot;.*KILL.*&quot;)</span>
        <span class="s2"># # transfers start of all clients, path to images and client number</span>
        <span class="s2"># self.begin_msg = re.compile(r'9999BEGIN(.*)@(.*)@(.*)@(.*)@(.*)9999(?!\s)')</span>
        <span class="s2"># # tranfers message from listener: listener number and round info</span>
        <span class="s2"># self.listener_msg = re.compile(r'9999LISTENER(.*)_(.*)9999(?!\s)')</span>
        <span class="s2"># self.listener_buttons_msg = re.compile(r&quot;9999BUTTONS_LISTENER(.*)@(.*)@(.*)9999&quot;)</span>
        <span class="s2"># # identifies message from speaker: current image, speaker number</span>
        <span class="s2"># # and round info</span>
        <span class="s2"># self.speaker_buttons_msg = re.compile(r&quot;9999BUTTONS_SPEAKER(.*)@(.*)@(.*)9999&quot;)</span>
        <span class="s2"># # a message that is directed to all participants</span>
        <span class="s2"># self.msg_for_all = re.compile(r&quot;9999ALL(.*)@(.*)9999(?!\s)&quot;)</span>
        <span class="s2"># # message that identifies the beginning of the experiment</span>
        <span class="s2"># # (welcome page)</span>
        <span class="s2"># self.welcome_msg = re.compile(r&quot;9999WELCOME(.*)9999(?!\s)&quot;)</span>
        <span class="s2"># # message for listener: the chosen picture</span>
        <span class="s2"># self.pic_from_speaker = re.compile(r&quot;9999PIC(.*)9999(?!\s)&quot;)</span>
        <span class="s2"># # listener response: the guessed picture</span>
        <span class="s2"># self.pic_from_listener = re.compile(r&quot;9999GUESS(.*)9999(?!\s)&quot;)</span>
        <span class="s2"># # coordinates</span>
        <span class="s2"># self.coords_from_speaker = re.compile(r&quot;9999COORD(.*)9999(?!\s)&quot;)</span>

        <span class="s2"># initialise the gui</span>
        <span class="s1">no_resize = wx.DEFAULT_FRAME_STYLE &amp; ~ (wx.RESIZE_BORDER |</span>
                                                <span class="s1">wx.MAXIMIZE_BOX)</span>
        <span class="s2"># wx.RESIZE_BOX |</span>

        <span class="s2"># Instantiate a frame - why is this done within GuiWindow class? Play with it</span>
        <span class="s2"># What is main_sizer and elements_in_sizer?</span>
        <span class="s1">wx.Frame.__init__(self, parent, id, title=</span><span class="s3">&quot;Communication Experiment&quot;</span><span class="s1">,</span>
                          <span class="s1">size=(</span><span class="s4">1600</span><span class="s1">, </span><span class="s4">800</span><span class="s1">))</span>
        <span class="s2"># create the main sizer</span>
        <span class="s1">self.main_sizer = wx.BoxSizer(wx.VERTICAL)</span>
        <span class="s2"># self.Show()</span>
        <span class="s1">self.SetSizer(self.main_sizer)</span>
        <span class="s1">self.Layout()</span>
        <span class="s1">self.SetBackgroundColour(</span><span class="s3">&quot;WHITE&quot;</span><span class="s1">)</span>

        <span class="s1">self.remove_elements_from_sizer()  </span><span class="s2"># What's this do?</span>
        <span class="s1">self.speaker_draw_stage()</span>
        <span class="s2"># threads = []</span>
        <span class="s2"># self.threads = threads</span>
        <span class="s2"># self.Bind(wx.EVT_CLOSE, self.on_exit_app)</span>

        <span class="s2"># # connect the client to the server</span>
        <span class="s2"># self.connect_to_server()</span>

        <span class="s2"># # self.threads.append(Reader(self.srvsock, self))</span>
        <span class="s2"># for thread in self.threads:</span>
        <span class="s2">#     # stops when everything else does</span>
        <span class="s2">#     thread.daemon = True</span>
        <span class="s2">#     thread.start()</span>

    <span class="s2"># after each window remove the displayed</span>
    <span class="s2"># elements from the sizer (not only hide them)</span>
    <span class="s2"># This means that new windows won't have sizers from previous sessions?</span>
    <span class="s2"># This prevents memory issues</span>
    <span class="s0">def </span><span class="s1">remove_elements_from_sizer(self):</span>
        <span class="s2">&quot;&quot;&quot;Remove all elements that were stored in the sizer.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">element </span><span class="s0">in </span><span class="s1">self.elements_in_sizer:</span>
            <span class="s0">try</span><span class="s1">:</span>
                <span class="s1">element.Hide()</span>
                <span class="s1">element.Destroy()</span>
            <span class="s0">except</span><span class="s1">:</span>
                <span class="s0">pass</span>
        <span class="s1">self.main_sizer.Clear()</span>

        <span class="s1">self.elements_in_sizer = []</span>
        <span class="s1">self.Layout()</span>

    <span class="s2"># def adjust_dimensions(self, im):</span>
    <span class="s2">#     &quot;&quot;&quot;Adjust the dimension of a given image.&quot;&quot;&quot;</span>
    <span class="s2">#     width = im.GetWidth()</span>
    <span class="s2">#     height = im.GetHeight()</span>
    <span class="s2">#     ratio = float(width) / float(height)</span>

    <span class="s2">#     newwidth = self.image_width * ratio</span>
    <span class="s2">#     newheight = self.image_height</span>
    <span class="s2">#     return((newwidth, newheight))</span>

    <span class="s2"># speaker_draw_stage(self) modifies class GuiWindow (self). Modified properties include:</span>
    <span class="s2"># 2 dummy panels (purpose?)</span>
    <span class="s2"># drawing panel -&gt; drawer interacts here.</span>

    <span class="s0">def </span><span class="s1">speaker_draw_stage(self):</span>
        <span class="s2">&quot;&quot;&quot;Stage were speaker has to 'draw' the line on the grid.&quot;&quot;&quot;</span>
        <span class="s2"># print(&quot;In speaker draw stage&quot;)</span>

        <span class="s1">self.role = </span><span class="s3">&quot;speaker&quot;</span>
        <span class="s1">dummy_panel_1 = DummyPanel(self)</span>
        <span class="s1">drawing_panel = DrawingPage(self)</span>
        <span class="s1">dummy_panel_2 = DummyPanel(self)</span>

        <span class="s1">self.main_sizer.Add(dummy_panel_1, </span><span class="s4">1</span><span class="s1">, wx.ALIGN_CENTER)</span>
        <span class="s1">self.main_sizer.Add(drawing_panel, </span><span class="s4">0</span><span class="s1">, wx.ALIGN_CENTER)</span>
        <span class="s1">self.main_sizer.Add(dummy_panel_2, </span><span class="s4">1</span><span class="s1">, wx.ALIGN_CENTER)</span>

        <span class="s1">self.SetSizer(self.main_sizer)</span>
        <span class="s1">self.Layout()</span>
        <span class="s1">self.elements_in_sizer.append(drawing_panel)</span>


<span class="s2"># DrawingPage class takes in a Panel object. Panels inherit from Window. It's a window where controls are placed</span>
<span class="s2"># and is usually placed within a Frame.</span>
<span class="s2"># This class also draws heavily on wx.grid.Grid</span>
<span class="s2"># Do none of these classes have methods they need to implement?</span>
<span class="s2"># Where are all these methods called? What is an Event?</span>
<span class="s2"># 9 methods</span>
<span class="s2"># 1) OnMotion(self,event) -&gt; nothing happens</span>
<span class="s2"># 2) CreateFeedbackGrid(self) -&gt; What does the feedback grid do?</span>
<span class="s2"># 3) OnClick(self,event) -&gt; Updates grid_list and clicked.</span>
<span class="s2"># 4) OnDClick(self,event) -&gt; Essentially the same as OnClick() but takes into account whether grid has been submitted.</span>
<span class="s2"># 5) CheckValue(self,coords) -&gt; Where is this used? How does DrawingPage interact with GuiWindow?</span>
<span class="s2"># 5) CheckValue(self,coords) -&gt; Where is this used? How does DrawingPage interact with GuiWindow?</span>
<span class="s2"># Makes sure that clicks are within threshold. If AllowErase = True, set grid square to white. Else set to black.</span>
<span class="s2"># AllowErase is a field in GuiWindow.</span>

<span class="s2"># tell the server there's been a click</span>
<span class="s2"># self.gui.srvsock.send(self.gui.encode_msg(&quot;6666&quot;+ str(tuple(coords)) +&quot;6666&quot;))</span>
<span class="s2"># set the cell color to black if there's been enough clicks</span>
<span class="s2"># CellValue = self.grid.GetCellValue(*coords)</span>

<span class="s2"># 6) add_submit_button(self,label) -&gt; defines a submit button</span>
<span class="s2"># 7) OnSubmit(self,event) -&gt; Triggered on clicking submission button; turns canClick to false (no more updating</span>
<span class="s2"># grid_list) and calls CreateFeedbackGrid().</span>
<span class="s2"># 8) close_up(self) -&gt; closes client</span>
<span class="s2"># 9) on_exit_app(self,event) -&gt; why is this needed?</span>
<span class="s2"># Fields are:</span>
<span class="s2"># grid_list -&gt; an array of 2D arrays that stores the coordinates of clicked cells.</span>
<span class="s2"># clicked -&gt; stores the clicked status of the whole grid (for a timer).</span>
<span class="s2"># canClick -&gt; allows cells to be clicked before (not after) submission.</span>
<span class="s2"># FBGrid -&gt; the grid that the receiver sees (if there is noise)</span>

<span class="s2"># Implement client/server structure -&gt; replace with this code</span>
<span class="s2"># Implement noise -&gt; for every given square you've clicked on, there is some probability of sending that square.</span>
<span class="s2"># Could do it by implementing noise when it's clicked on</span>
<span class="s2"># OR implementing it with a method that takes in and manipulates the Grid object</span>

<span class="s0">class </span><span class="s1">DrawingPage(wx.Panel):</span>
    <span class="s2">&quot;&quot;&quot;Panel for grid drawing.&quot;&quot;&quot;</span>
    <span class="s1">drawLock = threading.Lock()</span>

    <span class="s0">def </span><span class="s1">__init__(self, parent):</span>
        <span class="s2">&quot;&quot;&quot;Initialise the grid.&quot;&quot;&quot;</span>
        <span class="s1">wx.Panel.__init__(self, parent)</span>
        <span class="s1">self.gui = parent</span>

        <span class="s1">self.clicked = </span><span class="s0">False</span>
        <span class="s1">self.CanClick = </span><span class="s0">True</span>
        <span class="s1">self.drawnFeedbackGrid = </span><span class="s0">False</span>

        <span class="s1">self.ver_box_sizer = wx.BoxSizer(wx.VERTICAL)</span>

        <span class="s1">self.SetSizer(self.ver_box_sizer)</span>
        <span class="s1">self.ver_box_sizer.Fit(self)</span>
        <span class="s1">self.ver_box_sizer.Layout()</span>
        <span class="s1">self.Center()</span>

        <span class="s1">self.hor_box_sizer = wx.BoxSizer(wx.HORIZONTAL)</span>

        <span class="s2"># Initialize vector of filled values to transmit</span>
        <span class="s2"># self.fill_vector = [0]*self.gui.GridWidth*self.gui.GridHeight</span>

        <span class="s2"># Pics to display</span>

        <span class="s2"># self.image_1 = os.path.join(self.gui.image_path,&quot;image-1a.png&quot;)</span>
        <span class="s2"># # self.image_2 = os.path.join(self.gui.image_path,&quot;image-1b.png&quot;)</span>
        <span class="s2"># self.pic_1 = wx.Image(self.image_1)</span>
        <span class="s2"># # self.pic_2 = wx.Image(self.image_2)</span>
        <span class="s2"># self.dimensions_1 = self.gui.adjust_dimensions(self.pic_1)</span>
        <span class="s2"># self.pic_1.Rescale(int(self.dimensions_1[0]), int(self.dimensions_1[1]))</span>
        <span class="s2"># self.bmap_1 = wx.Bitmap(self.pic_1)</span>
        <span class="s2"># self.image_1 = wx.StaticBitmap(self, wx.ID_ANY, self.bmap_1, style=wx.BORDER_SIMPLE)</span>
        <span class="s2"># wx.lib.colourdb.updateColourDB() # adds more colors; we want to highlight the chosen pic</span>
        <span class="s2"># self.image_1.SetBackgroundColour(wx.Colour('PALE GREEN'))</span>
        <span class="s2"># self.dimensions_2 = self.gui.adjust_dimensions(self.pic_2)</span>
        <span class="s2"># self.pic_2.Rescale(self.dimensions_2[0], self.dimensions_2[1])</span>
        <span class="s2"># self.bmap_2 = wx.Bitmap(self.pic_2)</span>
        <span class="s2"># self.image_2 = wx.StaticBitmap(self, wx.ID_ANY, self.bmap_2)</span>

        <span class="s2"># Create a wxGrid object and a timer display, add them to sizer</span>
        <span class="s2"># self.allowed_time = 30</span>
        <span class="s2"># self.remaining = self.allowed_time</span>
        <span class="s2"># self.timer_display = wx.StaticText(self, label=&quot;You have %s seconds from your first click!&quot; % str(self.remaining))</span>
        <span class="s1">self.referent_display = wx.StaticText(self, label=</span><span class="s3">&quot;Flower&quot;</span><span class="s1">)</span>
        <span class="s1">self.grid = wx.grid.Grid(self, -</span><span class="s4">1</span><span class="s1">, style=wx.BORDER_SIMPLE)</span>
        <span class="s2"># self.ver_box_sizer.Add(self.timer_display,0)</span>
        <span class="s1">self.ver_box_sizer.Add(self.referent_display, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s2"># self.hor_box_sizer.Add(self.image_1,0)</span>
        <span class="s2"># # self.hor_box_sizer.Add(self.image_2,0)</span>
        <span class="s1">self.hor_box_sizer.Add(self.grid, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self.ver_box_sizer.Add(self.hor_box_sizer, </span><span class="s4">1</span><span class="s1">)</span>
        <span class="s1">self.GridRowSize = </span><span class="s4">40</span>
        <span class="s1">self.GridColSize = </span><span class="s4">40</span>

        <span class="s2"># Create the timer</span>
        <span class="s2"># self.timer = wx.Timer(self)</span>
        <span class="s2"># self.Bind(wx.EVT_TIMER, self.update, self.timer)</span>

        <span class="s2"># Add submit button</span>
        <span class="s1">self.add_submit_button(</span><span class="s3">&quot;Send&quot;</span><span class="s1">)</span>

        <span class="s2"># Then we call CreateGrid to set the dimensions of the grid</span>
        <span class="s1">self.grid.CreateGrid(self.gui.GridWidth, self.gui.GridHeight)</span>
        <span class="s1">self.grid.SetDefaultColSize(self.GridRowSize)</span>
        <span class="s1">self.grid.SetDefaultRowSize(self.GridColSize)</span>
        <span class="s1">self.grid.SetRowLabelSize(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self.grid.SetColLabelSize(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self.grid.SetCellHighlightROPenWidth(</span><span class="s4">0</span><span class="s1">)</span>
        <span class="s1">self.grid.ShowScrollbars(wx.SHOW_SB_NEVER, wx.SHOW_SB_NEVER)</span>
        <span class="s2"># self.grid.AutoSize() # &lt;--This may have to change</span>

        <span class="s1">self.grid_list = []</span>

        <span class="s2"># Make all cells read-only</span>
        <span class="s0">for </span><span class="s1">m </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s1">, self.gui.GridWidth):</span>
            <span class="s1">self.grid_list.append([])</span>
            <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s1">, self.gui.GridHeight):</span>
                <span class="s1">self.grid_list[m].append(</span><span class="s4">0</span><span class="s1">)</span>
                <span class="s1">self.grid.SetReadOnly(m, n)</span>
                <span class="s2"># self.grid.SetCellTextColour(m, n, &quot;white&quot;)</span>
                <span class="s2"># self.grid.SetCellValue(m,n,str(0))</span>

        <span class="s2"># Bind clicking events</span>
        <span class="s1">self.Bind(wx.grid.EVT_GRID_CELL_LEFT_CLICK, self.OnClick)</span>
        <span class="s2"># self.Bind(wx.grid.EVT_GRID_CELL_LEFT_DCLICK, self.OnDClick)</span>
        <span class="s2"># self.Bind(wx.grid.EVT_GRID_RANGE_SELECT, self.OnDragSelect)</span>

        <span class="s1">self.grid.GetGridWindow().Bind(wx.EVT_MOTION, self.OnMotion)  </span><span class="s2"># prevent drag selection</span>
        <span class="s2"># self.grid.GetGridWindow().Bind(wx.EVT_SCROLLWIN, self.OnScroll) #prevent drag selection</span>

        <span class="s2"># Clicks parameter</span>
        <span class="s1">self.ClickThreshold = </span><span class="s4">1</span>

        <span class="s2"># self.Show()</span>

    <span class="s0">def </span><span class="s1">OnMotion(self, event):</span>
        <span class="s0">pass</span>

    <span class="s2"># def OnScroll(self,event):</span>
    <span class="s2">#     print(&quot;scroll&quot;)</span>
    <span class="s2">#     event.Skip()</span>

    <span class="s2"># def OnDragSelect(self,event):</span>
    <span class="s2">#     # DrawingPage.drawLock.acquire()</span>
    <span class="s2">#     # print(&quot;OnDragSelect&quot;)</span>
    <span class="s2">#     self.grid.ClearSelection()</span>
    <span class="s2">#     # DrawingPage.drawLock.release()</span>

    <span class="s0">def </span><span class="s1">CreateFeedbackGrid(self):</span>
        <span class="s0">if </span><span class="s1">(self.drawnFeedbackGrid == </span><span class="s0">True</span><span class="s1">):</span>
            <span class="s1">print(</span><span class="s3">&quot;Feedback grid drawn at least once&quot;</span><span class="s1">)</span>
            <span class="s0">pass</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">self.drawnFeedbackGrid == </span><span class="s0">True</span>
            <span class="s1">print(</span><span class="s3">&quot;Feedback grid drawn first time&quot;</span><span class="s1">)</span>
            <span class="s1">self.FBgrid = wx.grid.Grid(self, -</span><span class="s4">1</span><span class="s1">, style=wx.BORDER_SIMPLE)</span>

            <span class="s1">self.FBgrid.CreateGrid(self.gui.GridWidth, self.gui.GridHeight)</span>
            <span class="s1">self.FBgrid.SetDefaultColSize(int(self.GridColSize / </span><span class="s4">1.5</span><span class="s1">))</span>
            <span class="s1">self.FBgrid.SetDefaultRowSize(int(self.GridRowSize / </span><span class="s4">1.5</span><span class="s1">))</span>
            <span class="s1">self.FBgrid.SetRowLabelSize(</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">self.FBgrid.SetColLabelSize(</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">self.FBgrid.SetCellHighlightROPenWidth(</span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">self.FBgrid.ShowScrollbars(wx.SHOW_SB_NEVER, wx.SHOW_SB_NEVER)</span>

            <span class="s1">self.FBgrid.GetGridWindow().Bind(wx.EVT_MOTION, self.OnMotion)  </span><span class="s2"># prevent drag selection</span>

            <span class="s1">self.hor_box_sizer.Add(self.FBgrid, </span><span class="s4">0</span><span class="s1">)</span>
            <span class="s1">self.hor_box_sizer.Fit(self)</span>
            <span class="s2"># self.ver_box_sizer.Add(self.hor_box_sizer,0)</span>
            <span class="s2"># self.SetSizer(self.ver_box_sizer)</span>
            <span class="s1">self.ver_box_sizer.Fit(self)</span>

            <span class="s2"># Sets all cells in grid to ReadOnly.</span>
            <span class="s0">for </span><span class="s1">m </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s1">, self.gui.GridWidth):</span>
                <span class="s0">for </span><span class="s1">n </span><span class="s0">in </span><span class="s1">range(</span><span class="s4">0</span><span class="s1">, self.gui.GridHeight):</span>
                    <span class="s1">self.FBgrid.SetReadOnly(m, n)</span>
                    <span class="s1">value = self.grid_list[m][n]</span>
                    <span class="s0">if </span><span class="s1">int(value) % </span><span class="s4">2 </span><span class="s1">!= </span><span class="s4">0</span><span class="s1">:</span>
                        <span class="s1">self.FBgrid.SetCellTextColour(m, n, wx.Colour(</span><span class="s3">&quot;black&quot;</span><span class="s1">))</span>
                        <span class="s1">self.FBgrid.SetCellBackgroundColour(m, n, wx.Colour(</span><span class="s3">&quot;black&quot;</span><span class="s1">))</span>
            <span class="s1">self.FBgrid.Refresh()</span>



    <span class="s0">def </span><span class="s1">OnClick(self, event):</span>
        <span class="s1">DrawingPage.drawLock.acquire()</span>
        <span class="s2"># print(&quot;OnClick&quot;)</span>
        <span class="s0">if </span><span class="s1">self.clicked == </span><span class="s0">False</span><span class="s1">:</span>
            <span class="s1">self.clicked = </span><span class="s0">True</span>
            <span class="s2"># self.gui.srvsock.send(self.gui.encode_msg(&quot;6666FIRSTCLICK6666&quot;))</span>
            <span class="s2"># self.StartTimer()</span>
            <span class="s2"># self.timer_display.SetLabel(&quot;%s seconds left!&quot; % str(self.remaining))</span>
        <span class="s0">if </span><span class="s1">self.CanClick == </span><span class="s0">True</span><span class="s1">:</span>
            <span class="s1">CellCoords = [event.GetRow(), event.GetCol()]</span>
            <span class="s2"># print(&quot;CellCoords&quot;,CellCoords)</span>
            <span class="s1">CellValue = self.grid_list[CellCoords[</span><span class="s4">0</span><span class="s1">]][CellCoords[</span><span class="s4">1</span><span class="s1">]]</span>
            <span class="s2"># CellValue = self.grid.GetCellValue(*CellCoords)</span>
            <span class="s2"># self.grid.SetCellTextColour(CellCoords[0],CellCoords[1], &quot;white&quot;) #Quick hack to stop bug where numbers sometimes visible</span>
            <span class="s2"># self.grid.SetCellValue(CellCoords[0],CellCoords[1],str(int(CellValue)+1))</span>
            <span class="s1">self.grid_list[CellCoords[</span><span class="s4">0</span><span class="s1">]][CellCoords[</span><span class="s4">1</span><span class="s1">]] += </span><span class="s4">1</span>
            <span class="s1">self.CheckValue(CellCoords)</span>
            <span class="s2"># print(&quot;Just checked value for OnClick&quot;)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">pass</span>
        <span class="s1">DrawingPage.drawLock.release()</span>

    <span class="s2">#</span>
    <span class="s0">def </span><span class="s1">OnDClick(self, event):</span>
        <span class="s1">DrawingPage.drawLock.acquire()</span>
        <span class="s2"># print(&quot;double clicking&quot;)</span>
        <span class="s2"># print &quot;OnDClick: &quot;, self.grid_list</span>
        <span class="s0">if </span><span class="s1">self.CanClick == </span><span class="s0">True</span><span class="s1">:</span>
            <span class="s1">CellCoords = [event.GetRow(), event.GetCol()]</span>
            <span class="s1">CellValue = self.grid_list[CellCoords[</span><span class="s4">0</span><span class="s1">]][CellCoords[</span><span class="s4">1</span><span class="s1">]]</span>
            <span class="s1">self.grid.SetCellTextColour(CellCoords[</span><span class="s4">0</span><span class="s1">], CellCoords[</span><span class="s4">1</span><span class="s1">],</span>
                                        <span class="s3">&quot;white&quot;</span><span class="s1">)  </span><span class="s2"># Quick hack to stop bug where numbers sometimes visible</span>
            <span class="s2"># self.grid.SetCellValue(CellCoords[0],CellCoords[1],str(int(CellValue)+1))</span>
            <span class="s1">self.grid_list[CellCoords[</span><span class="s4">0</span><span class="s1">]][CellCoords[</span><span class="s4">1</span><span class="s1">]] += </span><span class="s4">1</span>
            <span class="s1">self.CheckValue(CellCoords)</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s0">pass</span>
        <span class="s1">DrawingPage.drawLock.release()</span>

    <span class="s0">def </span><span class="s1">CheckValue(self, coords):</span>

        <span class="s2"># print(&quot;coords&quot;,coords)</span>
        <span class="s2"># tell the server there's been a click</span>
        <span class="s2"># self.gui.srvsock.send(self.gui.encode_msg(&quot;6666&quot;+ str(tuple(coords)) +&quot;6666&quot;))</span>
        <span class="s2"># set the cell color to black if there's been enough clicks</span>
        <span class="s2"># CellValue = self.grid.GetCellValue(*coords)</span>

        <span class="s1">CellValue = self.grid_list[coords[</span><span class="s4">0</span><span class="s1">]][coords[</span><span class="s4">1</span><span class="s1">]]</span>
        <span class="s2"># print(&quot;just got CellValue&quot;)</span>
        <span class="s0">if </span><span class="s1">int(CellValue) &gt;= self.ClickThreshold:</span>
            <span class="s2"># print(&quot;over threshold&quot;)</span>
            <span class="s1">CellValue = self.grid_list[coords[</span><span class="s4">0</span><span class="s1">]][coords[</span><span class="s4">1</span><span class="s1">]]</span>
            <span class="s2"># print(&quot;got Cellvalue again&quot;)</span>
            <span class="s1">self.grid.SetCellValue(coords[</span><span class="s4">0</span><span class="s1">], coords[</span><span class="s4">1</span><span class="s1">], </span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s1">self.gui.AllowErase == </span><span class="s0">True and </span><span class="s1">int(CellValue) % </span><span class="s4">2 </span><span class="s1">== </span><span class="s4">0</span><span class="s1">:</span>
                <span class="s1">self.grid.SetCellTextColour(coords[</span><span class="s4">0</span><span class="s1">], coords[</span><span class="s4">1</span><span class="s1">], wx.Colour(</span><span class="s3">&quot;white&quot;</span><span class="s1">))</span>
                <span class="s1">self.grid.SetCellBackgroundColour(coords[</span><span class="s4">0</span><span class="s1">], coords[</span><span class="s4">1</span><span class="s1">], wx.Colour(</span><span class="s3">&quot;white&quot;</span><span class="s1">))</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s1">self.grid.SetCellTextColour(coords[</span><span class="s4">0</span><span class="s1">], coords[</span><span class="s4">1</span><span class="s1">], wx.Colour(</span><span class="s3">&quot;black&quot;</span><span class="s1">))</span>
                <span class="s1">self.grid.SetCellBackgroundColour(coords[</span><span class="s4">0</span><span class="s1">], coords[</span><span class="s4">1</span><span class="s1">], wx.Colour(</span><span class="s3">&quot;black&quot;</span><span class="s1">))</span>
            <span class="s2"># print(self.fill_vector)</span>
            <span class="s2"># self.fill_vector[(coords[0]*self.gui.GridWidth)+coords[1]] = 1</span>
            <span class="s2"># print(self.fill_vector)</span>
            <span class="s1">self.grid.Refresh()</span>
        <span class="s2"># print(&quot;just refreshed&quot;)</span>

    <span class="s2"># def StartTimer(self):</span>
    <span class="s2">#     self.timer.Start(self.allowed_time)</span>

    <span class="s2"># def update(self, event):</span>
    <span class="s2">#     # print(&quot;update&quot;)</span>
    <span class="s2">#     self.remaining -= 1</span>
    <span class="s2">#     if self.remaining &lt; 1:</span>
    <span class="s2">#         pass</span>
    <span class="s2">#         # if self.gui.hard_mode:</span>
    <span class="s2">#         #     print(&quot;clearing out grid&quot;)</span>
    <span class="s2">#         #     self.fill_vector = [0]*(self.gui.GridWidth*self.gui.GridHeight) # clear out the grid in hard mode</span>
    <span class="s2">#         # self.gui.submitted_message = self.fill_vector</span>
    <span class="s2">#         # self.gui.submit_message()</span>
    <span class="s2">#         # self.timer.Stop()</span>
    <span class="s2">#     else:</span>
    <span class="s2">#         self.timer_display.SetLabel(&quot;%s seconds left!&quot; % str(self.remaining))</span>

    <span class="s0">def </span><span class="s1">add_submit_button(self, label):</span>
        <span class="s2">&quot;&quot;&quot;Add a submit button. Its position is set. 
 
        :param label: the text written on the button. 
        :type label: str. 
        &quot;&quot;&quot;</span>
        <span class="s1">submit_button = wx.Button(self, id=wx.ID_ANY,</span>
                                  <span class="s1">label=label,</span>
                                  <span class="s1">size=self.gui.submit_button_size)</span>
        <span class="s1">self.ver_box_sizer.Add(submit_button, </span><span class="s4">0</span><span class="s1">)</span>
        <span class="s2"># when the participant clicks on the button, the on_submit()</span>
        <span class="s2"># method is called</span>
        <span class="s1">submit_button.Bind(wx.EVT_BUTTON, self.OnSubmit)</span>
        <span class="s1">submit_button.Show()</span>
        <span class="s1">self.gui.elements_in_sizer.append(submit_button)</span>

    <span class="s0">def </span><span class="s1">OnSubmit(self, event):</span>
        <span class="s1">self.CanClick = </span><span class="s0">False</span>
        <span class="s1">self.drawnFeedbackGrid = </span><span class="s0">False</span>
        <span class="s1">self.CreateFeedbackGrid()</span>
        <span class="s2"># self.gui.submitted_message = self.fill_vector</span>
        <span class="s2"># self.gui.submit_message()</span>

    <span class="s0">def </span><span class="s1">close_up(self):</span>
        <span class="s2">&quot;&quot;&quot;Close everything.&quot;&quot;&quot;</span>
        <span class="s2"># self.srvsock.close()</span>
        <span class="s1">msg = </span><span class="s3">&quot;closing client&quot;</span>
        <span class="s1">pub.sendMessage(</span><span class="s3">&quot;clientclosed&quot;</span><span class="s1">, data=msg)</span>
        <span class="s1">self.Destroy()</span>
        <span class="s1">sys.exit()</span>

        <span class="s2"># comment this section out if you don't want run_client to remember</span>
        <span class="s2"># the ip next time</span>
        <span class="s2"># try:</span>
        <span class="s2"># os.remove('temp_ip')</span>
        <span class="s2"># except(WindowsError):</span>
        <span class="s2"># pass</span>

    <span class="s0">def </span><span class="s1">on_exit_app(self, event):</span>
        <span class="s2">&quot;&quot;&quot;A dummy function that runs if user tries to close the gui.&quot;&quot;&quot;</span>
        <span class="s0">pass</span>


<span class="s0">class </span><span class="s1">DummyPanel(wx.Panel):</span>
    <span class="s2">&quot;&quot;&quot;Dummy panel for getting elements in the middle of the page.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__(self, parent):</span>
        <span class="s2">&quot;&quot;&quot;Initialise panel with welcome message.&quot;&quot;&quot;</span>
        <span class="s1">wx.Panel.__init__(self, parent)</span>
        <span class="s1">self.gui = parent</span>
        <span class="s1">self.ver_box_sizer = wx.BoxSizer(wx.VERTICAL)</span>

        <span class="s2"># text = wx.StaticText(self, wx.ID_ANY, label=&quot;TEST&quot;)</span>
        <span class="s2"># self.ver_box_sizer.Add(text, 0)</span>

        <span class="s1">self.SetSizer(self.ver_box_sizer)</span>
        <span class="s2"># self.ver_box_sizer.Fit(self)</span>
        <span class="s1">self.ver_box_sizer.Layout()</span>
        <span class="s1">self.Center()</span>


<span class="s2"># The wx.App class represents the application and is used to:</span>
<span class="s2"># bootstrap the wxPython system and initialize the underlying gui toolkit</span>
<span class="s2"># set and get application-wide properties</span>
<span class="s2"># implement the native windowing system main message or event loop, and to dispatch events to window instances</span>
<span class="s2"># How does App interface with Frame and Window?</span>
<span class="s0">class </span><span class="s1">App(wx.App):</span>
    <span class="s2">&quot;&quot;&quot;The wx.Python application that starts the client gui.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">OnInit(self):</span>
        <span class="s2">&quot;&quot;&quot;Initialise the client setup frame. 
 
        Unfortunately this method's name has to be uppercase, because it's 
        wxPython (does not work with lower case letters). 
        &quot;&quot;&quot;</span>
        <span class="s1">self.frame = GuiWindow(parent=</span><span class="s0">None</span><span class="s1">, id=wx.ID_ANY, title=</span><span class="s3">&quot;&quot;</span><span class="s1">, host=</span><span class="s3">&quot;&quot;</span><span class="s1">, name=</span><span class="s3">&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">self.frame.Show()</span>
        <span class="s1">self.SetTopWindow(self.frame)</span>
        <span class="s0">return True</span>


<span class="s0">if </span><span class="s1">__name__ == </span><span class="s3">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s1">app = App()</span>
    <span class="s1">app.MainLoop()</span>

<span class="s2"># Can play around with this</span>



</pre>
</body>
</html>